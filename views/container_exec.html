<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

</head>
<body>
<p><input id="input" type="text" value="ls">
    <button id="send">Send</button>
</p>
<div id="output"></div>
<div id="msg_end" style="height:0px; overflow:hidden"></div>

</body>

<script>
    //获取QueryString的数组
    function getQueryString() {
        var result = location.search.match(new RegExp("[\?\&][^\?\&]+=[^\?\&]+", "g"));
        if (result == null) {
            return "";
        }
        for (var i = 0; i < result.length; i++) {
            result[i] = result[i].substring(1);
        }
        return result;
    }

    //根据QueryString参数名称获取值
    function getQueryStringByName(name) {
        var result = location.search.match(new RegExp("[\?\&]" + name + "=([^\&]+)", "i"));
        if (result == null || result.length < 1) {
            return "";

        }
        return result[1];
    }

    //根据QueryString参数索引获取值
    function getQueryStringByIndex(index) {
        if (index == null) {
            return "";
        }
        var queryStringList = getQueryString();
        if (index >= queryStringList.length) {
            return "";
        }
        var result = queryStringList[index];
        var startIndex = result.indexOf("=") + 1;
        result = result.substring(startIndex);
        return result;

    }

    var ns = getQueryStringByName("ns");
    var podName = getQueryStringByName("podName");


    var output = document.getElementById("output");
    var ws;
    var print = function (message) {
        var d = document.createElement("div");
        d.innerHTML = message;
        output.appendChild(d);
        document.getElementById("msg_end").scrollIntoView();
    };

    function open() {

        ws = new WebSocket("ws://localhost:9999/ns/" + ns + "/podName/" + podName + "/exec");
        ws.onopen = function (evt) {
            print("connected");
        }
        ws.onclose = function (evt) {
            print("CLOSE");
            ws = null;
        }
        ws.onmessage = function (evt) {
            print(evt.data);
        }
        ws.onerror = function (evt) {
            print("ERROR: " + evt.data);
        }

    }

    function close() {
        if (!ws) {
            return false;
        }
        ws.close();
        return false;
    }

    document.getElementById("send").onclick = function (evt) {
        if (!ws) {
            return false;
        }
        var input = document.getElementById("input");
        ws.send(input.value);
        return false;
    };

    open();

</script>
</html>